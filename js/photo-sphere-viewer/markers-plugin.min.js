/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /npm/@photo-sphere-viewer/markers-plugin@5.1.7/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("@photo-sphere-viewer/core")):"function"==typeof define&&define.amd?define(["exports","three","@photo-sphere-viewer/core"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).PhotoSphereViewer=e.PhotoSphereViewer||{},e.PhotoSphereViewer.MarkersPlugin={}),e.THREE,e.PhotoSphereViewer)}(this,(function(e,t,i){
/*!
 * PhotoSphereViewer.MarkersPlugin 5.1.7
 * @copyright 2023 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */
"use strict";var s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(e,t)=>{for(var i in t)s(e,i,{get:t[i],enumerable:!0})},h=()=>i,l=()=>t,c={};a(c,{MarkersPlugin:()=>oe,events:()=>v});var p=h(),v={};a(v,{EnterMarkerEvent:()=>E,GotoMarkerDoneEvent:()=>y,HideMarkersEvent:()=>C,LeaveMarkerEvent:()=>w,MarkerVisibilityEvent:()=>m,MarkersPluginEvent:()=>d,RenderMarkersListEvent:()=>V,SelectMarkerEvent:()=>S,SelectMarkerListEvent:()=>_,SetMarkersEvent:()=>z,ShowMarkersEvent:()=>j,UnselectMarkerEvent:()=>T});var g=h(),d=class extends g.TypedEvent{},u=class e extends d{constructor(t,i){super(e.type),this.marker=t,this.visible=i}};u.type="marker-visibility";var m=u,f=class e extends d{constructor(t){super(e.type),this.marker=t}};f.type="goto-marker-done";var y=f,k=class e extends d{constructor(t){super(e.type),this.marker=t}};k.type="leave-marker";var w=k,M=class e extends d{constructor(t){super(e.type),this.marker=t}};M.type="enter-marker";var E=M,b=class e extends d{constructor(t,i,s){super(e.type),this.marker=t,this.doubleClick=i,this.rightClick=s}};b.type="select-marker";var S=b,P=class e extends d{constructor(t){super(e.type),this.marker=t}};P.type="select-marker-list";var _=P,x=class e extends d{constructor(t){super(e.type),this.marker=t}};x.type="unselect-marker";var T=x,L=class e extends d{constructor(){super(e.type)}};L.type="hide-markers";var C=L,A=class e extends d{constructor(t){super(e.type),this.markers=t}};A.type="set-markers";var z=A,O=class e extends d{constructor(){super(e.type)}};O.type="show-markers";var j=O,N=class e extends d{constructor(t){super(e.type),this.markers=t}};N.type="render-markers-list";var V=N,D=h(),H=class extends D.AbstractButton{constructor(e){super(e,{className:"psv-markers-button",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 9 81 81"><path fill="currentColor" d="M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',hoverScale:!0,collapsable:!0,tabbable:!0}),this.plugin=this.viewer.getPlugin("markers"),this.plugin&&(this.plugin.addEventListener(j.type,this),this.plugin.addEventListener(C.type,this),this.toggleActive(!0))}destroy(){this.plugin&&(this.plugin.removeEventListener(j.type,this),this.plugin.removeEventListener(C.type,this)),super.destroy()}isSupported(){return!!this.plugin}handleEvent(e){e instanceof j?this.toggleActive(!0):e instanceof C&&this.toggleActive(!1)}onClick(){this.plugin.toggleAllMarkers()}};H.id="markers";var $=h(),R=h(),I='<svg xmlns="http://www.w3.org/2000/svg" viewBox="9 9 81 81"><path fill="currentColor" d="M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',q="http://www.w3.org/2000/svg",U="psvMarker",B=R.utils.dasherize(U),G="marker",Y="markersList",X={amount:2,duration:100,easing:"linear"},F=(e,t)=>`\n<div class="psv-panel-menu psv-panel-menu--stripped">\n <h1 class="psv-panel-menu-title">${I} ${t}</h1>\n <ul class="psv-panel-menu-list">\n   ${e.map((e=>`\n   <li data-${B}="${e.id}" class="psv-panel-menu-item" tabindex="0">\n     ${"image"===e.type?`<span class="psv-panel-menu-item-icon"><img src="${e.definition}"/></span>`:""}\n     <span class="psv-panel-menu-item-label">${e.getListContent()}</span>\n   </li>\n   `)).join("")}\n </ul>\n</div>\n`,W=class extends $.AbstractButton{constructor(e){super(e,{className:" psv-markers-list-button",icon:I,hoverScale:!0,collapsable:!0,tabbable:!0}),this.plugin=this.viewer.getPlugin("markers"),this.plugin&&(this.viewer.addEventListener($.events.ShowPanelEvent.type,this),this.viewer.addEventListener($.events.HidePanelEvent.type,this))}destroy(){this.viewer.removeEventListener($.events.ShowPanelEvent.type,this),this.viewer.removeEventListener($.events.HidePanelEvent.type,this),super.destroy()}isSupported(){return!!this.plugin}handleEvent(e){e instanceof $.events.ShowPanelEvent?this.toggleActive(e.panelId===Y):e instanceof $.events.HidePanelEvent&&this.toggleActive(!1)}onClick(){this.plugin.toggleMarkersList()}};W.id="markersList";var Z=h(),Q=l(),K=h(),J=l(),ee=h();function te(e,t,i){const[s,r]=e,[o,n]=t,a=ee.utils.greatArcDistance(e,t),h=Math.sin((1-i)*a)/Math.sin(a),l=Math.sin(i*a)/Math.sin(a),c=h*Math.cos(r)*Math.cos(s)+l*Math.cos(n)*Math.cos(o),p=h*Math.cos(r)*Math.sin(s)+l*Math.cos(n)*Math.sin(o),v=h*Math.sin(r)+l*Math.sin(n);return[Math.atan2(p,c),Math.atan2(v,Math.sqrt(c*c+p*p))]}function ie(e){const t=[e[0]];let i=0;for(let s=1;s<e.length;s++){const r=e[s-1][0]-e[s][0];r>Math.PI?i+=1:r<-Math.PI&&(i-=1),t.push([e[s][0]+2*i*Math.PI,e[s][1]])}return t}var se=(e=>(e.image="image",e.imageLayer="imageLayer",e.html="html",e.polygon="polygon",e.polygonPixels="polygonPixels",e.polyline="polyline",e.polylinePixels="polylinePixels",e.square="square",e.rect="rect",e.circle="circle",e.ellipse="ellipse",e.path="path",e))(se||{}),re=Z.utils.getConfigParser({clickEventOnMarker:!1,gotoMarkerSpeed:"8rpm",markers:null,defaultHoverScale:null},{defaultHoverScale:e=>e?(!0===e&&(e=X),"number"==typeof e&&(e={amount:e}),{...X,...e}):null}),oe=class extends Z.AbstractConfigurablePlugin{constructor(e,t){super(e,t),this.markers={},this.state={visible:!0,showAllTooltips:!1,currentMarker:null,hoveringMarker:null},this.container=document.createElement("div"),this.container.className="psv-markers",this.container.style.cursor=this.viewer.config.mousemove?"move":"default",this.svgContainer=document.createElementNS(q,"svg"),this.svgContainer.setAttribute("class","psv-markers-svg-container"),this.container.appendChild(this.svgContainer),this.container.addEventListener("mouseenter",this,!0),this.container.addEventListener("mouseleave",this,!0),this.container.addEventListener("mousemove",this,!0),this.container.addEventListener("contextmenu",this)}init(){super.init(),this.viewer.container.appendChild(this.container),this.viewer.addEventListener(Z.events.ClickEvent.type,this),this.viewer.addEventListener(Z.events.DoubleClickEvent.type,this),this.viewer.addEventListener(Z.events.RenderEvent.type,this),this.viewer.addEventListener(Z.events.ConfigChangedEvent.type,this),this.viewer.addEventListener(Z.events.ObjectEnterEvent.type,this),this.viewer.addEventListener(Z.events.ObjectHoverEvent.type,this),this.viewer.addEventListener(Z.events.ObjectLeaveEvent.type,this),this.viewer.addEventListener(Z.events.ReadyEvent.type,this,{once:!0})}destroy(){this.clearMarkers(!1),this.viewer.unobserveObjects(U),this.viewer.removeEventListener(Z.events.ClickEvent.type,this),this.viewer.removeEventListener(Z.events.DoubleClickEvent.type,this),this.viewer.removeEventListener(Z.events.RenderEvent.type,this),this.viewer.removeEventListener(Z.events.ConfigChangedEvent.type,this),this.viewer.removeEventListener(Z.events.ObjectEnterEvent.type,this),this.viewer.removeEventListener(Z.events.ObjectHoverEvent.type,this),this.viewer.removeEventListener(Z.events.ObjectLeaveEvent.type,this),this.viewer.removeEventListener(Z.events.ReadyEvent.type,this),this.viewer.container.removeChild(this.container),super.destroy()}handleEvent(e){switch(e.type){case Z.events.ReadyEvent.type:this.config.markers&&(this.setMarkers(this.config.markers),delete this.config.markers);break;case Z.events.RenderEvent.type:this.renderMarkers();break;case Z.events.ClickEvent.type:this.__onClick(e,!1);break;case Z.events.DoubleClickEvent.type:this.__onClick(e,!0);break;case Z.events.ConfigChangedEvent.type:this.container.style.cursor=this.viewer.config.mousemove?"move":"default";break;case Z.events.ObjectEnterEvent.type:case Z.events.ObjectLeaveEvent.type:case Z.events.ObjectHoverEvent.type:if(e.userDataKey===U){const t=e.originalEvent,i=e.object.userData[U];switch(e.type){case Z.events.ObjectEnterEvent.type:this.__onMouseEnter(t,i);break;case Z.events.ObjectLeaveEvent.type:this.__onMouseLeave(t,i);break;case Z.events.ObjectHoverEvent.type:this.__onMouseMove(t,i)}}break;case"mouseenter":this.__onMouseEnter(e,this.__getTargetMarker(e.target));break;case"mouseleave":this.__onMouseLeave(e,this.__getTargetMarker(e.target));break;case"mousemove":this.__onMouseMove(e,this.__getTargetMarker(e.target));break;case"contextmenu":e.preventDefault()}}toggleAllMarkers(){this.state.visible?this.hideAllMarkers():this.showAllMarkers()}showAllMarkers(){this.state.visible=!0,this.renderMarkers(),this.dispatchEvent(new j)}hideAllMarkers(){this.state.visible=!1,this.renderMarkers(),this.dispatchEvent(new C)}toggleAllTooltips(){this.state.showAllTooltips?this.hideAllTooltips():this.showAllTooltips()}showAllTooltips(){this.state.showAllTooltips=!0,Object.values(this.markers).forEach((e=>{e.state.staticTooltip=!0,e.showTooltip()}))}hideAllTooltips(){this.state.showAllTooltips=!1,Object.values(this.markers).forEach((e=>{e.state.staticTooltip=!1,e.hideTooltip()}))}getNbMarkers(){return Object.keys(this.markers).length}getMarkers(){return Object.values(this.markers)}addMarker(e,t=!0){if(this.markers[e.id])throw new Z.PSVError(`marker "${e.id}" already exists`);const i=new class e{constructor(t,i,s){if(this.viewer=t,this.plugin=i,this.visible=!0,this.state={dynamicSize:!1,anchor:null,visible:!1,staticTooltip:!1,position:null,position2D:null,positions3D:null,size:null},!s.id)throw new K.PSVError("missing marker id");if(this.type=e.getType(s),this.isNormal())this.element=document.createElement("div");else if(this.isPolygon())this.element=document.createElementNS(q,"polygon");else if(this.isPolyline())this.element=document.createElementNS(q,"polyline");else if(this.isSvg()){const e="square"===this.type?"rect":this.type,t=document.createElementNS(q,e);this.element=document.createElementNS(q,"svg"),this.domElement.appendChild(t)}else this.is3d()&&(this.element=this.__createMesh(),this.loader=new J.TextureLoader,this.viewer.config.withCredentials&&(this.loader.setWithCredentials(!0),this.loader.setCrossOrigin("use-credentials")));this.is3d()||(this.element.id=`psv-marker-${s.id}`,this.element[U]=this),(this.isNormal()||this.isSvg())&&this.domElement.addEventListener("transitionend",(()=>{this.domElement.style.transition=""})),this.update(s)}get id(){return this.config.id}get data(){return this.config.data}get domElement(){return this.is3d()?null:this.element}get threeElement(){return this.is3d()?this.element:null}destroy(){this.hideTooltip(),this.is3d()?delete this.threeElement.children[0].userData[U]:delete this.element[U]}is3d(){return"imageLayer"===this.type}isNormal(){return"image"===this.type||"html"===this.type}isPoly(){return this.isPolygon()||this.isPolyline()}isPolyPixels(){return"polygonPixels"===this.type||"polylinePixels"===this.type}isPolyAngles(){return"polygon"===this.type||"polyline"===this.type}isPolygon(){return"polygon"===this.type||"polygonPixels"===this.type}isPolyline(){return"polyline"===this.type||"polylinePixels"===this.type}isSvg(){return"square"===this.type||"rect"===this.type||"circle"===this.type||"ellipse"===this.type||"path"===this.type}getScale(e,t,i){let s=1;if("function"==typeof this.config.scale)s=this.config.scale(e,t);else if(this.config.scale){if(Array.isArray(this.config.scale.zoom)){const[t,i]=this.config.scale.zoom;s*=t+(i-t)*K.CONSTANTS.EASINGS.inQuad(e/100)}if(Array.isArray(this.config.scale.yaw)){const[e,i]=this.config.scale.yaw,r=J.MathUtils.degToRad(this.viewer.state.hFov)/2,o=Math.abs(K.utils.getShortestArc(this.state.position.yaw,t.yaw));s*=i+(e-i)*K.CONSTANTS.EASINGS.outQuad(Math.max(0,(r-o)/r))}}return i&&this.config.hoverScale&&(s*=this.config.hoverScale.amount),s}getListContent(){return this.config.listContent?this.config.listContent:this.config.tooltip?.content?this.config.tooltip.content:this.config.html?this.config.html:this.id}showTooltip(e,t){if(this.state.visible&&this.config.tooltip?.content&&this.state.position2D){const i={...this.config.tooltip,data:this,top:0,left:0};if(this.isPoly())if(e||t){const s=K.utils.getPosition(this.viewer.container);i.top=t-s.y,i.left=e-s.x,i.box={width:20,height:20}}else i.top=this.state.position2D.y,i.left=this.state.position2D.x;else{const e=this.viewer.dataHelper.vector3ToViewerCoords(this.state.positions3D[0]);let t=this.state.size.width,s=this.state.size.height;this.config.hoverScale&&!this.state.staticTooltip&&(t*=this.config.hoverScale.amount,s*=this.config.hoverScale.amount),i.top=e.y-s*this.state.anchor.y+s/2,i.left=e.x-t*this.state.anchor.x+t/2,i.box={width:t,height:s}}this.tooltip?this.tooltip.move(i):this.tooltip=this.viewer.createTooltip(i)}}refreshTooltip(){this.tooltip&&this.showTooltip()}hideTooltip(){this.tooltip&&(this.tooltip.hide(),this.tooltip=null)}update(t){const i=e.getType(t,!0);if(void 0!==i&&i!==this.type)throw new K.PSVError("cannot change marker type");if(K.utils.isExtendedPosition(t)&&(K.utils.logWarn('Use the "position" property to configure the position of a marker'),t.position=this.viewer.dataHelper.cleanPosition(t)),"width"in t&&"height"in t&&(K.utils.logWarn('Use the "size" property to configure the size of a marker'),t.size={width:t.width,height:t.height}),this.config=K.utils.deepmerge(this.config,t),"string"==typeof this.config.tooltip&&(this.config.tooltip={content:this.config.tooltip}),this.config.tooltip&&!this.config.tooltip.trigger&&(this.config.tooltip.trigger="hover"),this.config.scale&&Array.isArray(this.config.scale)&&(this.config.scale={zoom:this.config.scale}),"boolean"==typeof this.config.hoverScale?this.config.hoverScale=this.config.hoverScale?this.plugin.config.defaultHoverScale||X:null:"number"==typeof this.config.hoverScale?this.config.hoverScale={amount:this.config.hoverScale}:this.config.hoverScale||(this.config.hoverScale=this.plugin.config.defaultHoverScale),this.config.hoverScale&&(this.config.hoverScale={...X,...this.plugin.config.defaultHoverScale,...this.config.hoverScale}),this.visible=!1!==this.config.visible,this.state.anchor=K.utils.parsePoint(this.config.anchor),!this.is3d()){const e=this.domElement;e.setAttribute("class","psv-marker"),this.isNormal()||this.isSvg()?e.classList.add("psv-marker--normal"):e.classList.add("psv-marker--poly"),this.state.visible&&e.classList.add("psv-marker--visible"),this.config.tooltip&&e.classList.add("psv-marker--has-tooltip"),this.config.content&&e.classList.add("psv-marker--has-content"),this.config.className&&K.utils.addClasses(e,this.config.className),e.style.opacity=`${this.config.opacity??1}`,this.config.style&&Object.assign(e.style,this.config.style)}this.isNormal()?this.__updateNormal():this.isPoly()?this.__updatePoly():this.isSvg()?this.__updateSvg():this.is3d()&&this.__update3d()}__updateNormal(){const e=this.domElement;if(!K.utils.isExtendedPosition(this.config.position))throw new K.PSVError("missing marker position");if(this.config.image&&!this.config.size)throw new K.PSVError("missing marker size");switch(this.config.size?(this.state.dynamicSize=!1,this.state.size=this.config.size,e.style.width=this.config.size.width+"px",e.style.height=this.config.size.height+"px"):this.state.dynamicSize=!0,this.type){case"image":this.definition=this.config.image,e.style.backgroundImage=`url(${this.config.image})`;break;case"html":this.definition=this.config.html,e.innerHTML=this.config.html}e.style.transformOrigin=`${100*this.state.anchor.x}% ${100*this.state.anchor.y}%`,this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position),this.state.positions3D=[this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)]}__updateSvg(){const e=this.domElement.firstElementChild;if(!K.utils.isExtendedPosition(this.config.position))throw new K.PSVError("missing marker position");switch(this.state.dynamicSize=!0,this.type){case"square":this.definition={x:0,y:0,width:this.config.square,height:this.config.square};break;case"rect":Array.isArray(this.config.rect)?this.definition={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}:this.definition={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height};break;case"circle":this.definition={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case"ellipse":Array.isArray(this.config.ellipse)?this.definition={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}:this.definition={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry};break;case"path":this.definition={d:this.config.path}}Object.entries(this.definition).forEach((([t,i])=>{e.setAttributeNS(null,t,i)})),this.config.svgStyle?Object.entries(this.config.svgStyle).forEach((([t,i])=>{e.setAttributeNS(null,K.utils.dasherize(t),i)})):e.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.domElement.style.transformOrigin=`${100*this.state.anchor.x}% ${100*this.state.anchor.y}%`,this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position),this.state.positions3D=[this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)]}__updatePoly(){const e=this.domElement;this.state.dynamicSize=!0,this.config.svgStyle?(Object.entries(this.config.svgStyle).forEach((([t,i])=>{e.setAttributeNS(null,K.utils.dasherize(t),i)})),this.isPolyline()&&!this.config.svgStyle.fill&&e.setAttributeNS(null,"fill","none")):this.isPolygon()?e.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline()&&(e.setAttributeNS(null,"fill","none"),e.setAttributeNS(null,"stroke","rgb(0,0,0)"));const t=this.config[this.type];if(!Array.isArray(t[0]))for(let e=0;e<t.length;e++)t.splice(e,2,[t[e],t[e+1]]);this.isPolyPixels()?this.definition=t.map((e=>{const t=this.viewer.dataHelper.textureCoordsToSphericalCoords({textureX:e[0],textureY:e[1]});return[t.yaw,t.pitch]})):this.definition=t.map((e=>[K.utils.parseAngle(e[0]),K.utils.parseAngle(e[1],!0)]));const i=this.isPolygon()?function(e){const t=ie(e).reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]]));return[ee.utils.parseAngle(t[0]/e.length),t[1]/e.length]}(this.definition):function(e){const t=ie(e);let i=0;const s=[];for(let e=0;e<t.length-1;e++){const r=ee.utils.greatArcDistance(t[e],t[e+1])*ee.CONSTANTS.SPHERE_RADIUS;s.push(r),i+=r}let r=0;for(let e=0;e<t.length-1;e++){if(r+s[e]>i/2){const o=(i/2-r)/s[e];return te(t[e],t[e+1],o)}r+=s[e]}return t[Math.round(t.length/2)]}(this.definition);this.state.position={yaw:i[0],pitch:i[1]},this.state.positions3D=this.definition.map((e=>this.viewer.dataHelper.sphericalCoordsToVector3({yaw:e[0],pitch:e[1]})))}__update3d(){const e=this.threeElement,t=e.children[0];if(!K.utils.isExtendedPosition(this.config.position))throw new K.PSVError("missing marker position");if(!this.config.size)throw new K.PSVError("missing marker size");if(this.state.dynamicSize=!1,this.state.size=this.config.size,this.state.position=this.viewer.dataHelper.cleanPosition(this.config.position),this.state.positions3D=[this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)],"imageLayer"===this.type){switch(this.definition!==this.config.imageLayer&&(this.viewer.config.requestHeaders&&this.loader.setRequestHeader(this.viewer.config.requestHeaders(this.config.imageLayer)),t.material.map=this.loader.load(this.config.imageLayer,(e=>{e.anisotropy=4,this.viewer.needsUpdate()})),this.definition=this.config.imageLayer),t.position.set(this.state.anchor.x-.5,this.state.anchor.y-.5,0),t.material.opacity=this.config.opacity??1,e.position.copy(this.state.positions3D[0]),this.config.orientation){case"horizontal":e.lookAt(0,e.position.y,0),e.rotateX(this.state.position.pitch<0?-Math.PI/2:Math.PI/2);break;case"vertical-left":e.lookAt(0,0,0),e.rotateY(.4*-Math.PI);break;case"vertical-right":e.lookAt(0,0,0),e.rotateY(.4*Math.PI);break;default:e.lookAt(0,0,0)}e.scale.set(this.config.size.width/100,this.config.size.height/100,1)}}__createMesh(){const e=new J.MeshBasicMaterial({transparent:!0,opacity:1,depthTest:!1}),t=new J.PlaneGeometry(1,1),i=new J.Mesh(t,e);i.userData={[U]:this};const s=(new J.Group).add(i);return Object.defineProperty(s,"visible",{enumerable:!0,get:function(){return this.children[0].userData[U].visible},set:function(e){this.children[0].userData[U].visible=e}}),s}updateSize(){if(!this.state.dynamicSize)return;if(!this.isNormal()&&!this.isSvg())return;const e=this.domElement;e.classList.add("psv-marker--transparent");const t=e.style.transform;let i;e.style.transform="",this.isSvg()?(i=e.firstElementChild.getBoundingClientRect(),e.style.width=i.width+"px",e.style.height=i.height+"px"):i=e.getBoundingClientRect(),this.state.size={width:i.width,height:i.height},e.classList.remove("psv-marker--transparent"),t&&(e.style.transform=t),this.state.dynamicSize=!1}static getType(e,t=!1){const i=[];if(Object.keys(se).forEach((t=>{e[t]&&i.push(t)})),0===i.length&&!t)throw new K.PSVError(`missing marker content, either ${Object.keys(se).join(", ")}`);if(i.length>1)throw new K.PSVError(`multiple marker content, either ${Object.keys(se).join(", ")}`);return i[0]}}(this.viewer,this,e);i.isPoly()?this.svgContainer.appendChild(i.domElement):i.is3d()?this.viewer.renderer.addObject(i.threeElement):this.container.appendChild(i.domElement),this.markers[i.id]=i,t&&this.__afterChangerMarkers()}getMarker(e){const t="object"==typeof e?e.id:e;if(!this.markers[t])throw new Z.PSVError(`cannot find marker "${t}"`);return this.markers[t]}getCurrentMarker(){return this.state.currentMarker}updateMarker(e,t=!0){this.getMarker(e.id).update(e),t&&this.__afterChangerMarkers()}removeMarker(e,t=!0){const i=this.getMarker(e);i.isPoly()?this.svgContainer.removeChild(i.domElement):i.is3d()?this.viewer.renderer.removeObject(i.threeElement):this.container.removeChild(i.domElement),this.state.hoveringMarker===i&&(this.state.hoveringMarker=null),this.state.currentMarker===i&&(this.state.currentMarker=null),i.destroy(),delete this.markers[i.id],t&&this.__afterChangerMarkers()}removeMarkers(e,t=!0){e.forEach((e=>this.removeMarker(e,!1))),t&&this.__afterChangerMarkers()}setMarkers(e,t=!0){this.clearMarkers(!1),e?.forEach((e=>{this.addMarker(e,!1)})),t&&this.__afterChangerMarkers()}clearMarkers(e=!0){Object.keys(this.markers).forEach((e=>{this.removeMarker(e,!1)})),e&&this.__afterChangerMarkers()}gotoMarker(e,t=this.config.gotoMarkerSpeed){const i=this.getMarker(e);return t?this.viewer.animate({...i.state.position,zoom:i.config.zoomLvl,speed:t}).then((()=>{this.dispatchEvent(new y(i))})):(this.viewer.rotate(i.state.position),Z.utils.isNil(i.config.zoomLvl)||this.viewer.zoom(i.config.zoomLvl),this.dispatchEvent(new y(i)),Promise.resolve())}hideMarker(e){this.toggleMarker(e,!1)}showMarker(e){this.toggleMarker(e,!0)}showMarkerTooltip(e){const t=this.getMarker(e);t.state.staticTooltip=!0,t.showTooltip()}hideMarkerTooltip(e){const t=this.getMarker(e);t.state.staticTooltip=!1,t.hideTooltip()}toggleMarker(e,t){const i=this.getMarker(e);i.visible=null===t?!i.visible:t,this.viewer.needsUpdate()}showMarkerPanel(e){const t=this.getMarker(e);t?.config?.content?this.viewer.panel.show({id:G,content:t.config.content}):this.hideMarkerPanel()}hideMarkerPanel(){this.viewer.panel.hide(G)}toggleMarkersList(){this.viewer.panel.isVisible(Y)?this.hideMarkersList():this.showMarkersList()}showMarkersList(){let e=[];Object.values(this.markers).forEach((t=>{t.visible&&!t.config.hideList&&e.push(t)}));const t=new V(e);this.dispatchEvent(t),e=t.markers,this.viewer.panel.show({id:Y,content:F(e,this.viewer.config.lang[H.id]),noMargin:!0,clickHandler:e=>{const t=Z.utils.getClosest(e,"li"),i=t?t.dataset[U]:void 0;if(i){const e=this.getMarker(i);this.dispatchEvent(new _(e)),this.gotoMarker(e.id),this.hideMarkersList()}}})}hideMarkersList(){this.viewer.panel.hide(Y)}renderMarkers(){const e=this.viewer.getZoomLevel(),t=this.viewer.getPosition();Object.values(this.markers).forEach((i=>{let s=this.state.visible&&i.visible,r=!1,o=null;if(s&&i.is3d())o=this.__getMarkerPosition(i),s=this.__isMarkerVisible(i,o);else if(s&&i.isPoly()){const e=this.__getPolyPositions(i);if(s=e.length>(i.isPolygon()?2:1),s){o=this.__getMarkerPosition(i);const t=e.map((e=>e.x-o.x+","+(e.y-o.y))).join(" ");i.domElement.setAttributeNS(null,"points",t),i.domElement.setAttributeNS(null,"transform",`translate(${o.x} ${o.y})`)}}else s&&(i.updateSize(),o=this.__getMarkerPosition(i),s=this.__isMarkerVisible(i,o),s&&(i.domElement.style.translate=`${o.x}px ${o.y}px 0px`,this.__applyScale(i,{zoomLevel:e,viewerPosition:t,mouseover:null})));r=i.state.visible!==s,i.state.visible=s,i.state.position2D=s?o:null,i.is3d()||Z.utils.toggleClass(i.domElement,"psv-marker--visible",s),s?i.state.staticTooltip?i.showTooltip():"click"===i.config.tooltip?.trigger||i===this.state.hoveringMarker&&!i.isPoly()?i.refreshTooltip():i!==this.state.hoveringMarker&&i.hideTooltip():i.hideTooltip(),r&&this.dispatchEvent(new m(i,s))}))}__applyScale(e,{zoomLevel:t,viewerPosition:i,mouseover:s}){null!==s&&e.config.hoverScale&&(e.domElement.style.transition=`scale ${e.config.hoverScale.duration}ms ${e.config.hoverScale.easing}`);const r=e.getScale(t,i,s);e.domElement.style.scale=`${r}`}__isMarkerVisible(e,t){return e.state.positions3D[0].dot(this.viewer.state.direction)>0&&t.x+e.state.size.width>=0&&t.x-e.state.size.width<=this.viewer.state.size.width&&t.y+e.state.size.height>=0&&t.y-e.state.size.height<=this.viewer.state.size.height}__getMarkerPosition(e){if(e.isPoly())return this.viewer.dataHelper.sphericalCoordsToViewerCoords(e.state.position);{const t=this.viewer.dataHelper.vector3ToViewerCoords(e.state.positions3D[0]);return t.x-=e.state.size.width*e.state.anchor.x,t.y-=e.state.size.height*e.state.anchor.y,t}}__getPolyPositions(e){const t=e.state.positions3D.length,i=e.state.positions3D.map((e=>({vector:e,visible:e.dot(this.viewer.state.direction)>0}))),s=[];return i.forEach(((e,r)=>{if(!e.visible){[0===r?i[t-1]:i[r-1],r===t-1?i[0]:i[r+1]].forEach((t=>{t.visible&&s.push({visible:t.vector,invisible:e.vector,index:r})}))}})),s.reverse().forEach((e=>{i.splice(e.index,0,{vector:this.__getPolyIntermediaryPoint(e.visible,e.invisible),visible:!0})})),i.filter((e=>e.visible)).map((e=>this.viewer.dataHelper.vector3ToViewerCoords(e.vector)))}__getPolyIntermediaryPoint(e,t){const i=this.viewer.state.direction.clone().normalize(),s=(new Q.Vector3).crossVectors(e,t).normalize(),r=(new Q.Vector3).crossVectors(s,e).normalize(),o=e.clone().multiplyScalar(-i.dot(r)),n=r.clone().multiplyScalar(i.dot(e)),a=(new Q.Vector3).addVectors(o,n).normalize(),h=(new Q.Vector3).crossVectors(a,i);return a.applyAxisAngle(h,.01).multiplyScalar(Z.CONSTANTS.SPHERE_RADIUS)}__getTargetMarker(e,t=!1){const i=t?Z.utils.getClosest(e,".psv-marker"):e;return i?i[U]:void 0}__targetOnTooltip(e,t){return!(!e||!t)&&Z.utils.hasParent(e,t.container)}__onMouseEnter(e,t){t&&!t.isPoly()&&(this.state.hoveringMarker=t,this.dispatchEvent(new E(t)),(t.isNormal()||t.isSvg())&&this.__applyScale(t,{zoomLevel:this.viewer.getZoomLevel(),viewerPosition:this.viewer.getPosition(),mouseover:!0}),t.state.staticTooltip||"hover"!==t.config.tooltip?.trigger||t.showTooltip(e.clientX,e.clientY))}__onMouseLeave(e,t){!t||t.isPoly()&&this.__targetOnTooltip(e.relatedTarget,t.tooltip)||(this.dispatchEvent(new w(t)),(t.isNormal()||t.isSvg())&&this.__applyScale(t,{zoomLevel:this.viewer.getZoomLevel(),viewerPosition:this.viewer.getPosition(),mouseover:!1}),this.state.hoveringMarker=null,t.state.staticTooltip||"hover"!==t.config.tooltip?.trigger||t.hideTooltip())}__onMouseMove(e,t){let i;t?.isPoly()?i=t:this.state.hoveringMarker&&this.__targetOnTooltip(e.target,this.state.hoveringMarker.tooltip)&&(i=this.state.hoveringMarker),i?(this.state.hoveringMarker||(this.dispatchEvent(new E(i)),this.state.hoveringMarker=i),i.state.staticTooltip||i.showTooltip(e.clientX,e.clientY)):this.state.hoveringMarker?.isPoly()&&(this.dispatchEvent(new w(this.state.hoveringMarker)),this.state.hoveringMarker.state.staticTooltip||this.state.hoveringMarker.hideTooltip(),this.state.hoveringMarker=null)}__onClick(e,t){let i=e.data.objects.find((e=>e.userData[U]))?.userData[U];i||(i=this.__getTargetMarker(e.data.target,!0)),this.state.currentMarker&&this.state.currentMarker!==i&&(this.dispatchEvent(new T(this.state.currentMarker)),this.viewer.panel.hide(G),this.state.showAllTooltips||"click"!==this.state.currentMarker.config.tooltip?.trigger||this.hideMarkerTooltip(this.state.currentMarker.id),this.state.currentMarker=null),i&&(this.state.currentMarker=i,this.dispatchEvent(new S(i,t,e.data.rightclick)),this.config.clickEventOnMarker?e.data.marker=i:e.stopImmediatePropagation(),this.markers[i.id]&&("click"===i.config.tooltip?.trigger?i.tooltip?this.hideMarkerTooltip(i):this.showMarkerTooltip(i):this.showMarkerPanel(i.id)))}__afterChangerMarkers(){this.__refreshUi(),this.__checkObjectsObserver(),this.viewer.needsUpdate(),this.dispatchEvent(new z(this.getMarkers()))}__refreshUi(){const e=Object.values(this.markers).filter((e=>!e.config.hideList)).length;0===e?(this.viewer.panel.isVisible(Y)||this.viewer.panel.isVisible(G))&&this.viewer.panel.hide():this.viewer.panel.isVisible(Y)?this.showMarkersList():this.viewer.panel.isVisible(G)&&(this.state.currentMarker?this.showMarkerPanel(this.state.currentMarker.id):this.viewer.panel.hide()),this.viewer.navbar.getButton(H.id,!1)?.toggle(e>0),this.viewer.navbar.getButton(W.id,!1)?.toggle(e>0)}__checkObjectsObserver(){Object.values(this.markers).some((e=>e.is3d()))?this.viewer.observeObjects(U):this.viewer.unobserveObjects(U)}};oe.id="markers",oe.configParser=re,oe.readonlyOptions=["markers"],p.DEFAULTS.lang[H.id]="Markers",p.DEFAULTS.lang[W.id]="Markers list",(0,p.registerButton)(H,"caption:left"),(0,p.registerButton)(W,"caption:left"),((e,t,i,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let h of o(t))n.call(e,h)||h===i||s(e,h,{get:()=>t[h],enumerable:!(a=r(t,h))||a.enumerable})})(s(e,"__esModule",{value:!0}),c)}));
//# sourceMappingURL=/sm/0dfb4cf29609b11bbe22c8b89baf5672bede239d7bb01989fc5632e8e6ee657d.map